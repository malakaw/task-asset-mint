[2021-06-03 09:44:14,981][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 09:44:16,675][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 09:44:16,809][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 09:44:17,186][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 09:44:17,194][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 09:44:18,183][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 09:44:18,654][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0);


[2021-06-03 09:44:18,661][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,662][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0);


[2021-06-03 09:44:18,664][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,664][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34);


[2021-06-03 09:44:18,666][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,666][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12);


[2021-06-03 09:44:18,668][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,668][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97);


[2021-06-03 09:44:18,670][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,670][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2);


[2021-06-03 09:44:18,672][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,672][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10);


[2021-06-03 09:44:18,674][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,674][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5);


[2021-06-03 09:44:18,676][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,676][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8);


[2021-06-03 09:44:18,678][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,678][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0);


[2021-06-03 09:44:18,680][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,680][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0);


[2021-06-03 09:44:18,681][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,681][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541);


[2021-06-03 09:44:18,683][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,683][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93);


[2021-06-03 09:44:18,684][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,685][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21);


[2021-06-03 09:44:18,686][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:44:18,686][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`

 
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49);


[2021-06-03 09:44:18,688][ERROR][zmaxx-etl.db-client] Field 'calculate_begin_date' doesn't have a default value
[2021-06-03 09:52:26,143][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 09:52:27,179][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 09:52:27,316][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 09:52:27,689][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 09:52:27,697][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 09:52:28,564][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 09:52:28,985][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:28,994][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:28,994][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:28,996][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:28,997][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,001][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,001][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,003][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,005][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,007][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,007][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,009][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,009][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,010][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,011][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,012][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,013][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,015][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,015][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,017][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,018][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,020][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,020][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,022][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,022][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,024][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,025][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,026][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:52:29,027][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:52:29,029][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:02,077][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 09:53:02,914][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 09:53:03,035][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 09:53:03,437][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 09:53:03,445][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 09:53:04,282][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 09:53:04,700][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,709][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,709][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,712][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,712][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,715][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,715][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,717][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,717][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,719][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,720][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,722][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,723][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,725][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,725][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,727][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,728][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,730][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,730][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,732][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,733][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,735][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,735][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,737][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,737][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,739][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,739][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,740][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:53:04,741][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:53:04,742][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''2021-05-11', '2021-05-11')' at line 29
[2021-06-03 09:54:38,922][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 09:54:39,777][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 09:54:39,904][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 09:54:40,289][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 09:54:40,295][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 09:54:41,176][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 09:54:41,718][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,724][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,737][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,738][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,740][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,741][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,744][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,744][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,748][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,749][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,751][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,752][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,754][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,755][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,757][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,758][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,761][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,761][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,764][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,764][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,768][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,769][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,771][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,771][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,774][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,775][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,779][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:54:41,779][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:54:41,782][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11' for key 'idx_d'
[2021-06-03 09:57:24,085][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 09:57:24,918][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 09:57:25,042][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 09:57:25,381][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 09:57:25,390][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 09:57:26,226][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 09:57:26,638][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,647][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 09:57:26,647][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,651][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,654][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,657][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,660][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,663][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,666][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,669][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,672][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,675][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,677][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,680][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,682][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 09:57:26,685][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:34,959][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:14:35,927][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:14:36,065][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:14:36,423][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:14:36,435][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
group by store_key 


[2021-06-03 10:14:37,295][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:14:37,708][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 3, 0.012839887135807034, 10, 0.9871601128641929, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,716][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 51, 0.03332133337189108, 37, 0.9666786666281089, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,719][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 1, 0.027426673349643826, 2, 0.9725733266503562, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,721][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 4, 0.02087499657562389, 5, 0.9791250034243761, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,724][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 1, 0.0059911242603549585, 8, 0.994008875739645, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,727][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,730][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,733][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 3, 0.03426043485161089, 11, 0.9657395651483891, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,736][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,738][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 1, 0.05112090741646768, 1, 0.9488790925835323, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,741][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 5, 0.022909893884561414, 1, 0.9770901061154386, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,744][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,747][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 5, 0.012045494999071902, 4, 0.9879545050009281, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,750][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 2, 0.035066727070890834, 4, 0.9649332729291091, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:14:37,753][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:26:25,892][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:26:25,905][INFO][com.mchange.v2.log.MLog] MLog clients using log4j logging.
[2021-06-03 10:26:26,382][INFO][com.mchange.v2.c3p0.C3P0Registry] Initializing c3p0-0.9.2.1 [built 20-March-2013 10:47:27 +0000; debug? true; trace: 10]
[2021-06-03 10:26:26,439][INFO][com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource] Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 2, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -> 2t22hnah1lml9i9axtyna|388ffbc2, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> null, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, identityToken -> 2t22hnah1lml9i9axtyna|388ffbc2, idleConnectionTestPeriod -> 10, initialPoolSize -> 1, jdbcUrl -> jdbc:mysql://127.0.0.1:3306/zmaxx_001?zeroDateTimeBehavior=convertToNull, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 50, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 50, maxStatements -> 5, maxStatementsPerConnection -> 100, minPoolSize -> 1, numHelperThreads -> 3, preferredTestQuery -> select 1, properties -> {user=******, password=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]
[2021-06-03 10:26:27,861][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:26:28,011][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:26:28,358][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:26:28,374][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 10:26:28,811][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:27:02,130][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:27:02,140][INFO][com.mchange.v2.log.MLog] MLog clients using log4j logging.
[2021-06-03 10:27:02,230][INFO][com.mchange.v2.c3p0.C3P0Registry] Initializing c3p0-0.9.2.1 [built 20-March-2013 10:47:27 +0000; debug? true; trace: 10]
[2021-06-03 10:27:02,281][INFO][com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource] Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 2, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -> 2t22hnah1lmm17214nqj6|388ffbc2, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> null, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, identityToken -> 2t22hnah1lmm17214nqj6|388ffbc2, idleConnectionTestPeriod -> 10, initialPoolSize -> 1, jdbcUrl -> jdbc:mysql://127.0.0.1:3306/zmaxx_001?zeroDateTimeBehavior=convertToNull, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 50, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 50, maxStatements -> 5, maxStatementsPerConnection -> 100, minPoolSize -> 1, numHelperThreads -> 3, preferredTestQuery -> select 1, properties -> {user=******, password=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]
[2021-06-03 10:27:03,427][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:27:03,560][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:27:03,900][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:27:03,907][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 10:27:04,322][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:41:06,703][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:41:07,553][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:41:07,691][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:41:08,064][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:41:08,079][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 10:41:08,553][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:41:09,038][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,043][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,046][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,049][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,051][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,054][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,058][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,061][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,073][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,076][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,079][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,082][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,085][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,089][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:41:09,092][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:23,527][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:51:23,547][INFO][com.mchange.v2.log.MLog] MLog clients using log4j logging.
[2021-06-03 10:51:24,055][INFO][com.mchange.v2.c3p0.C3P0Registry] Initializing c3p0-0.9.2.1 [built 20-March-2013 10:47:27 +0000; debug? true; trace: 10]
[2021-06-03 10:51:24,122][INFO][com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource] Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 2, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -> 2t22hnah1lnhd3aykicme|40c6dd61, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> null, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, identityToken -> 2t22hnah1lnhd3aykicme|40c6dd61, idleConnectionTestPeriod -> 10, initialPoolSize -> 1, jdbcUrl -> jdbc:mysql://127.0.0.1:3306/zmaxx_001?zeroDateTimeBehavior=convertToNull, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 50, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 50, maxStatements -> 5, maxStatementsPerConnection -> 100, minPoolSize -> 1, numHelperThreads -> 3, preferredTestQuery -> select 1, properties -> {user=******, password=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]
[2021-06-03 10:51:25,898][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:51:26,034][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:51:26,376][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:51:26,391][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 10:51:26,850][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:51:27,275][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,297][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,303][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,307][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,311][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,316][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,322][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,327][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,332][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,335][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,339][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,343][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,346][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,350][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:51:27,353][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:55,915][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 10:57:56,797][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 10:57:56,927][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 10:57:57,280][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 10:57:57,296][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 10:57:57,751][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 10:57:58,168][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 10:57:58,170][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,179][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 10:57:58,180][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,183][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 10:57:58,184][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,188][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 10:57:58,189][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,192][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 10:57:58,192][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,195][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 10:57:58,196][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,199][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 10:57:58,199][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,202][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 10:57:58,203][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,206][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 10:57:58,206][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,210][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 10:57:58,210][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,214][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 10:57:58,215][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,218][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 10:57:58,219][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,222][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 10:57:58,223][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,228][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 10:57:58,228][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,233][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 10:57:58,233][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 10:57:58,236][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 11:04:18,611][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 11:04:19,634][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 11:04:19,765][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 11:04:20,124][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 11:04:20,131][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 11:04:20,657][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 11:04:21,100][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 11:04:21,101][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,102][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,103][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,104][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,104][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,105][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,106][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,106][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,107][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,108][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,108][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,108][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,109][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,109][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:04:21,110][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:38,932][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 11:16:40,199][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 11:16:40,577][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 11:16:40,961][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 11:16:40,969][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 11:16:41,681][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 11:16:42,153][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 11:16:42,155][INFO][zmaxx-etl.sale] 15
[2021-06-03 11:16:42,155][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,155][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,156][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,156][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,156][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,157][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,157][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,157][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,157][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,158][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,158][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,158][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,158][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,159][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:16:42,159][INFO][zmaxx-etl.sale] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:02,983][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 11:18:03,856][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 11:18:03,902][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 11:18:04,244][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 11:18:04,249][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 11:18:04,819][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 11:18:05,297][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 11:18:05,298][INFO][zmaxx-etl.sale] 15
[2021-06-03 11:18:05,298][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,304][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 11:18:05,304][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,307][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 11:18:05,308][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,310][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 11:18:05,311][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,313][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 11:18:05,313][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,316][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 11:18:05,316][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,319][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 11:18:05,319][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,322][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 11:18:05,322][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,326][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 11:18:05,326][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,329][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 11:18:05,329][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,334][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 11:18:05,334][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,337][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 11:18:05,338][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,340][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 11:18:05,340][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,343][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 11:18:05,343][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,346][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 11:18:05,346][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:05,348][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 11:18:28,217][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 11:18:29,082][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 11:18:29,138][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 11:18:29,553][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 11:18:29,559][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 11:18:29,978][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 11:18:30,399][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 11:18:30,400][INFO][zmaxx-etl.sale] 15
[2021-06-03 11:18:30,400][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,407][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,410][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,413][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,416][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,420][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,423][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,427][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,430][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,432][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,434][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,437][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,440][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,443][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 11:18:30,446][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 12:04:10,476][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:04:10,496][INFO][com.mchange.v2.log.MLog] MLog clients using log4j logging.
[2021-06-03 12:04:10,601][INFO][com.mchange.v2.c3p0.C3P0Registry] Initializing c3p0-0.9.2.1 [built 20-March-2013 10:47:27 +0000; debug? true; trace: 10]
[2021-06-03 12:04:10,676][INFO][com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource] Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 2, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -> 2t22hnah1lq2ye6q7kos8|1adb82d7, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> null, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, identityToken -> 2t22hnah1lq2ye6q7kos8|1adb82d7, idleConnectionTestPeriod -> 10, initialPoolSize -> 1, jdbcUrl -> jdbc:mysql://127.0.0.1:3306/zmaxx_001?zeroDateTimeBehavior=convertToNull, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 50, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 50, maxStatements -> 5, maxStatementsPerConnection -> 100, minPoolSize -> 1, numHelperThreads -> 3, preferredTestQuery -> select 1, properties -> {user=******, password=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]
[2021-06-03 12:04:12,044][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:04:12,103][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:04:12,457][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:04:12,463][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:04:12,894][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:06:50,925][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:06:51,768][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:06:51,815][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:06:52,178][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:06:52,183][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:06:52,593][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:07:24,014][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:07:24,853][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:07:24,902][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:07:25,248][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:07:25,253][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:07:25,653][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:07:56,627][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:07:57,467][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:07:57,517][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:07:57,862][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:07:57,866][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:07:58,265][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:08:20,308][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:08:21,184][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:08:21,236][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:08:21,646][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:08:21,651][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:08:22,103][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:08:35,888][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:08:36,726][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:08:36,775][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:08:37,135][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:08:37,140][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:08:37,561][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:08:58,663][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:08:59,473][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:08:59,525][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:08:59,862][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:08:59,866][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:09:00,274][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:10:03,581][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:10:04,474][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:10:04,524][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:10:04,874][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:10:04,878][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:10:05,275][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:10:42,826][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:10:43,645][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:10:43,695][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:10:44,053][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:10:44,058][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:10:44,463][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:11:59,991][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:12:00,810][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:12:00,861][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:12:01,242][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:12:01,247][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:12:01,656][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:17:19,072][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:17:19,928][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:17:19,977][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:17:20,373][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:17:20,377][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:17:20,781][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:19:18,971][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:19:19,809][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:19:19,863][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:19:20,258][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:19:20,275][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:19:20,677][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:20:01,454][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:20:02,417][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:20:02,469][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:20:02,806][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:20:02,811][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:20:03,219][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:21:01,122][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:21:01,974][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:21:02,021][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:21:02,378][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:21:02,382][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:21:02,793][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:22:02,639][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:22:03,456][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:22:03,518][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:22:03,854][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:22:03,859][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:22:04,277][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:22:38,162][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:22:39,002][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:22:39,053][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:22:39,405][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:22:39,411][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:22:39,855][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:23:11,976][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:23:12,963][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:23:13,012][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:23:13,350][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:23:13,355][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:23:13,761][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:27:47,930][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:27:48,785][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:27:48,835][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:27:49,205][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:27:49,214][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:27:49,627][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:29:54,741][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:29:55,600][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:29:55,649][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:29:55,995][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:29:56,002][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:29:56,425][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:34:15,127][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:34:15,967][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:34:16,015][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:34:16,433][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:34:16,439][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:34:16,859][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:34:31,757][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:34:32,592][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:34:32,651][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:34:33,014][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:34:33,020][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:34:33,428][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:35:05,625][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:35:06,458][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:35:06,505][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:35:06,858][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:35:06,864][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:35:07,273][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:38:29,089][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:38:29,941][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:38:29,993][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:38:30,364][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:38:30,375][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:38:30,776][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 12:39:02,311][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 12:39:03,133][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 12:39:03,182][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 12:39:03,520][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 12:39:03,525][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 12:39:03,924][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 13:14:19,259][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 24:00:00'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:14:19,274][INFO][com.mchange.v2.log.MLog] MLog clients using log4j logging.
[2021-06-03 13:14:19,430][INFO][com.mchange.v2.c3p0.C3P0Registry] Initializing c3p0-0.9.2.1 [built 20-March-2013 10:47:27 +0000; debug? true; trace: 10]
[2021-06-03 13:14:19,507][INFO][com.mchange.v2.c3p0.impl.AbstractPoolBackedDataSource] Initializing c3p0 pool... com.mchange.v2.c3p0.ComboPooledDataSource [ acquireIncrement -> 2, acquireRetryAttempts -> 30, acquireRetryDelay -> 1000, autoCommitOnClose -> false, automaticTestTable -> null, breakAfterAcquireFailure -> false, checkoutTimeout -> 0, connectionCustomizerClassName -> null, connectionTesterClassName -> com.mchange.v2.c3p0.impl.DefaultConnectionTester, dataSourceName -> 2t22hnah1lsl5we11basa1|521a757, debugUnreturnedConnectionStackTraces -> false, description -> null, driverClass -> null, factoryClassLocation -> null, forceIgnoreUnresolvedTransactions -> false, identityToken -> 2t22hnah1lsl5we11basa1|521a757, idleConnectionTestPeriod -> 10, initialPoolSize -> 1, jdbcUrl -> jdbc:mysql://127.0.0.1:3306/zmaxx_001?zeroDateTimeBehavior=convertToNull, maxAdministrativeTaskTime -> 0, maxConnectionAge -> 0, maxIdleTime -> 50, maxIdleTimeExcessConnections -> 0, maxPoolSize -> 50, maxStatements -> 5, maxStatementsPerConnection -> 100, minPoolSize -> 1, numHelperThreads -> 3, preferredTestQuery -> select 1, properties -> {user=******, password=******}, propertyCycle -> 0, statementCacheNumDeferredCloseThreads -> 0, testConnectionOnCheckin -> false, testConnectionOnCheckout -> false, unreturnedConnectionTimeout -> 0, userOverrides -> {}, usesTraditionalReflectiveProxies -> false ]
[2021-06-03 13:14:20,927][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:14:20,991][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:14:21,410][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key;


[2021-06-03 13:14:21,419][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 24:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 


[2021-06-03 13:14:21,867][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 24:00:00'
group by store_key 

[2021-06-03 13:14:22,295][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:15:27,216][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:15:28,085][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:15:28,155][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:15:28,554][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:15:28,559][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:15:28,986][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:15:29,404][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:18:17,761][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:18:18,631][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:18:18,680][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:18:19,045][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:18:19,051][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:18:19,455][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:18:19,856][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:18:19,859][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:18:19,859][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,877][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,880][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,884][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,888][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,892][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,895][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,897][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,900][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,903][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,905][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,908][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,911][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,914][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:18:19,917][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:40,669][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:19:41,538][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:19:41,587][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:19:41,956][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:19:41,961][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:19:42,374][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:19:42,810][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:19:42,813][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:19:42,813][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,817][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,820][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,822][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,825][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,828][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,831][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,835][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,837][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,840][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,842][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,845][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,848][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,851][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:19:42,855][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:24,908][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:20:25,764][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:20:25,818][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:20:26,199][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:20:26,203][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:20:26,683][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:20:27,137][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:20:27,140][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:20:27,140][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,143][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,145][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,148][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,150][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,153][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,156][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,160][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,164][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,167][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,172][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,176][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,179][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,182][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:20:27,184][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:21:23,459][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:21:24,381][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:21:24,434][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:21:24,802][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:21:24,807][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:21:25,222][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:21:25,628][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:25:10,904][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:25:11,809][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:25:11,863][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:25:12,236][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:25:12,243][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:25:12,669][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:25:13,067][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:25:13,069][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:25:13,069][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,079][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,081][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,084][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,086][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,088][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,091][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,093][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,095][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,098][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,100][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,102][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,104][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,106][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:25:13,109][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:34,490][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:26:35,368][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:26:35,417][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:26:35,775][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:26:35,779][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:26:36,186][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:26:36,598][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:26:36,600][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:26:36,600][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,608][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,610][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,613][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,615][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,617][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,619][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,621][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,624][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,625][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,628][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,630][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,632][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,634][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:26:36,636][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:45,268][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:49:46,253][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:49:46,314][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:49:46,730][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:49:46,734][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:49:47,156][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:49:47,570][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:49:47,572][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:49:47,573][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,585][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 13:49:47,585][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,588][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 13:49:47,588][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,591][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 13:49:47,591][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,594][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 13:49:47,594][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,597][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 13:49:47,598][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,600][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 13:49:47,600][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,603][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 13:49:47,603][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,605][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 13:49:47,605][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,607][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 13:49:47,607][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,610][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 13:49:47,610][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,613][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 13:49:47,613][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,615][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 13:49:47,615][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,618][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 13:49:47,618][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,620][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 13:49:47,621][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:49:47,623][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 13:50:03,728][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:50:04,586][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:50:04,638][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:50:05,045][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:50:05,049][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:50:05,462][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:50:05,865][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:50:05,867][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:50:05,867][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,871][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,874][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,877][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,879][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,881][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,883][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,887][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,889][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,891][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,893][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,896][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,898][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,900][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:05,903][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:37,413][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:50:38,258][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:50:38,307][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:50:38,661][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:50:38,665][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:50:39,088][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:50:39,506][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:50:39,509][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:50:39,509][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,512][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,516][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,519][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,521][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,524][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,527][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,530][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,533][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,536][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,538][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,540][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,542][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,544][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:50:39,546][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:15,354][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:51:16,183][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:51:16,238][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:51:16,749][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:51:16,753][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:51:17,169][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:51:17,584][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:51:17,586][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:51:17,586][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,591][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 13:51:17,595][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,599][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 13:51:17,599][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,602][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 13:51:17,603][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,607][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 13:51:17,609][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,613][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 13:51:17,613][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,623][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 13:51:17,624][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,632][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 13:51:17,632][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,636][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 13:51:17,636][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,642][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 13:51:17,642][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,645][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 13:51:17,646][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,649][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 13:51:17,649][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,653][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 13:51:17,654][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,658][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 13:51:17,659][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,662][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 13:51:17,662][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:51:17,665][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 13:52:12,673][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:52:13,545][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:52:13,597][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:52:13,960][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:52:13,964][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:52:14,390][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:52:14,805][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:52:14,806][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:52:14,806][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,810][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 13:52:14,811][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,813][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 13:52:14,813][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,815][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 13:52:14,815][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,817][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 13:52:14,818][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,820][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 13:52:14,820][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,822][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 13:52:14,822][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,825][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 13:52:14,825][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,827][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 13:52:14,828][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,830][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 13:52:14,830][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,832][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 13:52:14,833][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,835][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 13:52:14,835][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,838][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 13:52:14,838][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,841][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 13:52:14,841][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,843][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 13:52:14,844][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:52:14,846][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 13:53:04,977][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 13:53:05,839][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 13:53:05,897][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 13:53:06,266][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 13:53:06,272][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 13:53:06,694][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 13:53:07,094][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 13:53:07,096][INFO][zmaxx-etl.sale] 15
[2021-06-03 13:53:07,096][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,100][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-10' for key 'idx_cd'
[2021-06-03 13:53:07,100][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,102][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-11' for key 'idx_cd'
[2021-06-03 13:53:07,103][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,105][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-12' for key 'idx_cd'
[2021-06-03 13:53:07,105][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,107][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-13' for key 'idx_cd'
[2021-06-03 13:53:07,107][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,109][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-14' for key 'idx_cd'
[2021-06-03 13:53:07,109][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,111][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-17' for key 'idx_cd'
[2021-06-03 13:53:07,112][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,115][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-18' for key 'idx_cd'
[2021-06-03 13:53:07,115][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,118][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-19' for key 'idx_cd'
[2021-06-03 13:53:07,118][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,121][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-21' for key 'idx_cd'
[2021-06-03 13:53:07,121][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,124][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-26' for key 'idx_cd'
[2021-06-03 13:53:07,124][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,126][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-27' for key 'idx_cd'
[2021-06-03 13:53:07,127][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,131][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-32' for key 'idx_cd'
[2021-06-03 13:53:07,131][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,134][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-4' for key 'idx_cd'
[2021-06-03 13:53:07,134][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,137][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-5' for key 'idx_cd'
[2021-06-03 13:53:07,138][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 13:53:07,140][ERROR][zmaxx-etl.db-client] Duplicate entry '2021-05-11-2021-05-11-6' for key 'idx_cd'
[2021-06-03 14:18:31,789][INFO][zmaxx-etl.sale] in db
[2021-06-03 14:20:46,565][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 14:20:47,630][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 14:20:47,704][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 14:20:48,057][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 14:20:48,061][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 14:20:48,507][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 14:25:59,050][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 14:25:59,990][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 14:26:00,046][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 14:26:00,467][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 14:26:00,475][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 14:26:00,898][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 14:26:01,306][INFO][zmaxx-etl.sale] in...insert.....
[2021-06-03 14:26:01,308][INFO][zmaxx-etl.sale] 15
[2021-06-03 14:26:01,309][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (10, '上海（诺亚新天地店）', 13247.779999999868, 13247.779999999868, 0.44018092272691195, 5831.420024483072, 2716.0, 3062256.0, 25619.0, 1.6016880275085965, 4.8776804123710855, 97,
                                      56,   32.429771, 48.5, 15, 883.18536, 0, 0.0, 10, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,314][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (11, '浙江（杭州工联大厦店）', 50139.050000002535, 50139.050000002535, 0.437419136256846, 21931.779943739923, 8762.0, 1.772182E7, 31726.0, 0.8111162243697909, 5.722329376854889, 151,
                                      165,   40.974043, 53.1030303030303, 101, 496.42624, 0, 0.0, 37, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,317][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (12, '浙江（杭州古墩印象城店）', 12090.419999999975, 12090.419999999975, 0.5345571105892061, 6463.019981009935, 960.0, 424128.0, 26201.0, 3.894901144640999, 12.594187499999974, 76,
                                      39,   58.928125, 24.615384615384617, 39, 310.01077, 0, 0.0, 2, 1.0, 0.8717949, 34,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,319][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (13, '浙江（杭州绿地店）', 7300.600000000012, 7300.600000000012, 0.4593047150761405, 3353.200002884877, 1060.0, 890014.0, 28707.0, 3.5392676612008382, 6.887358490566049, 64,
                                      27,   36.54557, 39.25925925925926, 20, 365.03, 0, 0.0, 5, 1.0, 0.44444445, 12,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,322][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (14, '浙江（杭州in77店）', 31096.00000000037, 31096.00000000037, 0.42854097007734004, 13325.910005525126, 5798.0, 7816402.0, 28819.0, 0.8306623623681328, 5.363228699551634, 140,
                                      104,   47.32346, 55.75, 105, 296.15237, 0, 0.0, 8, 1.0, 0.9326923, 97,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,325][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (17, '江苏（泰州姜堰店）', 767.5999999999999, 767.5999999999999, -0.7360604486470426, -565.0000003814698, 12.0, 1248.0, 4433.0, 12.046195652173912, 63.96666666666666, 6,
                                      5,   88.783331, 2.4, 5, 153.52, 0, 0.0, 3, 1.0, 0.4, 2,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,329][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (18, '浙江（慈溪保利店）', 10400.999999999995, 10400.999999999995, 0.3164464897197569, 3291.35993957519, 96.0, 50624.0, 7712.0, 4.221127531472359, 108.34374999999994, 16,
                                      10,   226.800005, 9.6, 11, 945.5455, 0, 0.0, 1, 1.0, 1.0, 10,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,332][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (19, '安徽（蚌埠金鹏广场店）', 10081.59999999999, 10081.59999999999, -0.28727583104969057, -2896.2000183105574, 108.0, 7738.0, 5728.0, 3.0663811563169165, 93.34814814814806, 51,
                                      20,   276.009432, 5.4, 21, 480.0762, 0, 0.0, 11, 1.0, 0.25, 5,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,335][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (21, '江苏（淮安玖珑汇店）', 4059.250000000003, 4059.250000000003, 0.17231015224589594, 699.4499855041536, 55.0, 17424.0, 7697.0, 5.744029850746268, 73.80454545454552, 10,
                                      8,   120.345454, 6.875, 9, 451.02777, 0, 0.0, 1, 1.0, 1.0, 8,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,337][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (26, '上海（北上海广场店）', 66301.64000000058, 66301.64000000058, 0.29260995467604467, 19400.5198753476, 2128.0, 1067230.0, 26236.0, 2.6919761953621997, 31.156785714285988, 82,
                                      38,   103.610528, 56.0, 1, 66301.64, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,340][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (27, '浙江（杭州新天地店）', 13042.399999999834, 13042.399999999834, 0.4313347250673696, 5625.64001821859, 2720.0, 4073580.0, 27173.0, 2.2520304989225925, 4.794999999999939, 70,
                                      33,   38.732075, 82.42424242424242, 1, 13042.4, 0, 0.0, 1, 1.0, 0.0, 0,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,343][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (32, '江苏（南京新街口店）', 10704.78999999984, 10704.78999999984, 0.40711681635320274, 4358.100024529536, 2276.0, null, 26447.0, 0.5496394205790054, 4.7033347978909665, 229,
                                      539,   41.069255, 4.222634508348794, 545, 19.641817, 0, 0.0, 2, 1.0, 1.0037106, 541,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,346][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (4, '上海（七宝凯德店）', 42248.16000000086, 42248.16000000086, 0.5241752525775476, 22145.439938937096, 4752.0, 4074900.0, 26829.0, 1.169886190206253, 8.890606060606242, 160,
                                      97,   42.244255, 48.98969072164948, 98, 431.10367, 0, 0.0, 4, 1.0, 0.9587629, 93,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,348][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (5, '上海（宝山新业坊店）', 5783.259999999997, 5783.259999999997, 0.4434142665217308, 2564.3799910044636, 1176.0, 1464900.0, 11293.0, 1.1003605183669491, 4.917738095238092, 48,
                                      25,   26.822807, 47.04, 26, 222.43307, 0, 0.0, 4, 1.0, 0.84, 21,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:26:01,350][INFO][zmaxx-etl.db-client] 
 INSERT INTO `rb_sale` (             `store_key`,
				     `store_name`, 
                                     `payment`,
                                     `payment_per_day`,
                                     `gross_rate`, 
                                     `gross`,
                                     `sale_qty`,
                                     `purchase_qty`,
                                     `kcsl`,
                                     `stock_turnover_days`, 
                                     `unit_goods_price`, 
                                     `sku_distinct_count`,
                                     `order_count`,
                                     `avg_order_pay`,
                                     `joint_rate`,
                                     `buy_user_count`,
                                     `per_user_pay`,
                                     `new_user_count`,
                                     `new_user_rate`,
                                     `old_user_count`,
                                     `old_user_rate`,
                                     `userless_order_rate`,
                                     `userless_order_count`,
                                     `calculate_begin_date`,
                                     `calculate_end_date`
                                     )
                                     VALUES
                                     (6, '上海（桃浦新邻天地店）', 22848.599999999708, 22848.599999999708, 0.3830694211165453, 8752.599975323385, 3560.0, 3691298.0, 27843.0, 1.9541690061763055, 6.418146067415648, 85,
                                      52,   36.873134, 68.46153846153847, 53, 431.10565, 0, 0.0, 4, 1.0, 0.9423077, 49,
                                     '2021-05-11', '2021-05-11');


[2021-06-03 14:47:15,995][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 14:47:17,454][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 14:47:17,594][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 14:47:17,959][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 14:47:17,972][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 14:47:18,651][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 14:49:03,834][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from zmaxx_001.order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
				   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 14:49:04,884][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 14:49:04,998][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from zmaxx_001.order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 14:49:05,367][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 14:49:05,375][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 14:49:05,874][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 16:18:28,503][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 16:18:28,522][ERROR][zmaxx-etl.db-client] You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'order as zorder on zorder.id =   orderI.order_id 	
                   where     ' at line 21
[2021-06-03 16:20:17,074][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  db_dmp_zmaxx_01.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 16:20:17,091][ERROR][zmaxx-etl.db-client] Table 'db_dmp_zmaxx_01.order' doesn't exist
[2021-06-03 18:04:34,821][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:04:36,514][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:04:36,638][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:04:37,012][ERROR][zmaxx-etl.db-client] Non-terminating decimal expansion; no exact representable decimal result.
[2021-06-03 18:06:22,722][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:06:23,661][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:06:23,792][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:06:24,161][ERROR][zmaxx-etl.db-client] Non-terminating decimal expansion; no exact representable decimal result.
[2021-06-03 18:07:35,378][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:07:36,297][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:07:36,397][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:07:36,756][ERROR][zmaxx-etl.db-client] Non-terminating decimal expansion; no exact representable decimal result.
[2021-06-03 18:11:14,035][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:11:14,989][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:11:15,041][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:11:15,397][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:11:15,407][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:11:15,971][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:12:20,916][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:12:21,868][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:12:22,001][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:12:22,383][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:12:22,389][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:12:22,866][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:13:57,482][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:13:58,473][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:13:58,597][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:13:58,963][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:13:58,978][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:13:59,449][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:14:20,866][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:14:21,798][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:14:21,923][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:14:22,279][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:14:22,292][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:14:22,741][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:14:45,887][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:14:46,819][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:14:46,965][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:14:47,328][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:14:47,335][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:14:47,787][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:15:31,154][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:15:32,083][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:15:32,208][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:15:32,565][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:15:32,572][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:15:33,011][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:18:14,729][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:18:15,658][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:18:15,794][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:18:16,160][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:18:16,173][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:18:16,621][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:18:31,257][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:18:32,179][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:18:32,309][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:18:32,696][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:18:32,704][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:18:33,141][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:18:42,668][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:18:43,581][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:18:43,707][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:18:44,063][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:18:44,070][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:18:44,540][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:19:46,325][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:19:47,326][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:19:47,455][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:19:47,850][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:19:47,867][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:19:48,355][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:19:57,885][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:19:58,854][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:19:58,967][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:19:59,350][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:19:59,357][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:19:59,837][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:20:29,384][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:20:30,386][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:20:30,503][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:20:30,900][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:20:30,906][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:20:31,367][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:20:59,873][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:21:00,807][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:21:00,930][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:21:01,312][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:21:01,324][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:21:01,784][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:42:01,198][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:42:02,483][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:42:02,697][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:42:03,055][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:42:03,070][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:42:03,584][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:43:04,325][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:43:05,335][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:43:05,452][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:43:05,989][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:43:05,997][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:43:06,454][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:44:22,318][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:44:23,277][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:44:23,410][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:44:23,820][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:44:23,835][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:44:24,339][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

[2021-06-03 18:46:11,103][INFO][zmaxx-etl.db-client] 
select  orderI.store_key , 
			   rds.name,   
                           sum(orderI.sku_pay) as payment , 
                           (sum(orderI.sku_pay) - sum(rdp.jj))/sum(orderI.sku_pay) as gross_profit,   
                           (sum(orderI.sku_pay) - sum(rdp.jj)) as gross,                    
                           sum(orderI.sku_qty) as qty,
                           sum(rdpu.sl) as purchase_sl,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty) as unit_merchan_price,
                           sum(rdp.jj) as jj,
                           count(distinct(orderI.order_id))  as order_count,
                           sum(orderI.sku_pay)/count(distinct(orderI.order_id)) as  unit_order_price,
                           sum(orderI.sku_qty)/count(distinct(orderI.order_id))  as  joint_rate,
                           AVG(zorder.order_pay) as avg_order_pay,
                           sum(orderI.sku_pay)/sum(orderI.sku_qty)  as unit_goods_price,
                           count(distinct(orderI.sku_id)) as sku_distinct_count,
                           count(distinct(zorder.customer_key)) as user_count
                   from order_item as orderI
                   left join  rd_product as rdp on rdp.id = orderI.sku_id 
                   left join  rd_store as rds on rds.`id` =  orderI.store_key
                   left join  rd_purchase  as rdpu on rdpu.market = orderI.store_key
		   left join  zmaxx_001.order as zorder on zorder.id =   orderI.order_id 	
                   where        orderI.order_source='redian'  
                           and  orderI.sku_pay>0                    
                           and  orderI.create_dt >=  '2021-05-11 00:00:00' 
                           and  orderI.create_dt <= '2021-05-11 23:59:59'
                           #and  p_stock.kcsl > 0
                   group by orderI.store_key ;


[2021-06-03 18:46:12,057][INFO][zmaxx-etl.db-client] 
    select market,sum(kcsl)  as kcsl from rd_product_stock where kcsl > 0 group by market 


[2021-06-03 18:46:12,167][INFO][zmaxx-etl.db-client] 
select  store_key, sum(CAST(sku_qty AS DECIMAL(12,2)) ) as sale_qty_30  from order_item where order_create > DATE_SUB('2021-05-11',INTERVAL 30 DAY)  group by store_key
[2021-06-03 18:46:12,664][INFO][zmaxx-etl.db-client] 
select store_key,count(order_id) as user_null_count from zmaxx_001.order 
where customer_key = 0  and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key;


[2021-06-03 18:46:12,674][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as new_u,sum(order_pay) as new_u_pay from zmaxx_001.order 
where  customer_key not in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 23:59:59'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 


[2021-06-03 18:46:13,147][INFO][zmaxx-etl.db-client] 
select store_key,COUNT(DISTINCT(customer_key)) as old_u,sum(order_pay) as old_u_pay from zmaxx_001.order 
where  customer_key   in
(
select distinct(customer_key) as old_key from zmaxx_001.order   where      order_create  <= '2021-05-11 00:00:00'
)
and order_create >=  '2021-05-11 00:00:00'  and   order_create  <= '2021-05-11 23:59:59'
group by store_key 

